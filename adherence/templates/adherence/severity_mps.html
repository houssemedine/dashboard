{% extends 'base2.html' %}
{% load static %}

{% block children %}

<div class="card card-primary card-outline" style="overflow-x:scroll;overflow-y:scroll;height: 550px !important; ">
    <div class="card-header">
        <h5 class="m-0">SEVERITY MPS</h5>
    </div>
    <div class="card-body">
        <ul class="list-group list-group-horizontal" style="margin-top: 10px; margin-bottom: 10px;">
            <li class="list-group-item" style="padding:0.4rem 0.6rem">Year: {{year}}</li>
            <li class="list-group-item" style="padding:0.4rem 0.6rem">Week: {{week}}</li>
        </ul>
        {% if overview_week.iterrows %}
        
        <div style="height: 400px">
            <canvas id="indicatorweek"></canvas>

            <script>
                var xValues = [{% for index, data in indicatorweek.iterrows %} {{data.division}}, {% endfor %}];
                // var xValues = [6,9,7,3,10,7,4,6]
                var severity_mps = [{% for index, data in indicatorweek.iterrows %} (Math.round({{data.severity_mps}}) ), {% endfor %}];
                // var severity_mps_v = [{% for index, data in indicatorweek.iterrows %}(Math.round({{data.severity_mps_v}}) ), {% endfor %}];
                var barColors = ['#845EC2','#D65DB1','#FF6F91','#FF9671','#FFC75F','#008F7A','#4E8397','#C34A36'];
                
                new Chart("indicatorweek", {
                    type: "bar",
                    data: {
                            labels: xValues,
                            datasets: [
                                {
                                label: "Severity MPS",
                                backgroundColor: barColors,
                                borderColor: barColors,
                                borderWidth: 1,
                                data: severity_mps
                                },
                                // {
                                // label: "MPS Valentin",
                                // backgroundColor: "#27879E",
                                // borderColor: "#27879E",
                                // borderWidth: 1,
                                // data: severity_mps_v
                                // },
                            ]
                            },
                            options: {
                                plugins: {
                                        datalabels: {
                                            anchor: 'center',
                                            clamp: true,
                                            color: 'black',
                                            
                                        },
                                        legend: {
                                        display: false,
                                        position:'right',
                                        align:'middle',
                                        labels: {
                                        usePointStyle: true,
                                        boxWidth: 6
                                        },
                                        },
        
                                        title: {
                                            display: false,
                                            text: "tile"
                                        },
                                                                        // add persent sign to tooltip 
                                        tooltip: {
                                            callbacks: {
                                                label: function(context) {
                                                    var label = context.dataset.label || '';
                                                    if (context.parsed.y !== null) {
                                                        label += ' ' +context.parsed.y + '%';
                                                    }
                                                    return label;
                                                }
                                            }
                                        }
                                        
                                    },
                                    responsive: true,
                                    maintainAspectRatio:false, 
        
                            }
                });
            </script>
        </div>

        {% else %}
        <center style="margin-top: 15%;"><img src="{% static 'img/nodatafound.png' %}" alt="">
        <p class="card-text text-center">
            No Data available for this selection
        </p>
        <a class="btn btn-primary" href="{% url 'adhrencemexepcalcul' %}" role="button">Calculate now</a>
        </center>

        {% endif %}
    </div>
</div>

{% endblock children%}
